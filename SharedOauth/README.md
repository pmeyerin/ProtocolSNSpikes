# Demonstration of OAUTH ecosystem

## How to run
1. Start Keycloak
   1. Navigate to keycloak home/bin
   2. `./kc.sh start-dev --http-port 9080`
2. Import the supplied realm
3. Add a user to the realm and give the user the role `user`
4. Navigate to the `cronResource` project
5. `./gradlew bootRun`
6. Navigate to `keycloakClient` project
7. `./gradlew bootRun`
8. Note that shortly after startup the keycloak client console will log that it has accessed an endpoint on the `cronResource` service
    1. This demonstrates a service using its own credentials to access a restricted resource on a resource server.
9. In a browser open `http://localhost:8080` 
10. Click the customers link. 
11. Enter the credentials for the user you created in step 3.
12. Note that you see resources that were pulled from `keycloakClient`.
    1. This demonstrates a service functioning as both a client and a resource server
    2. This demonstrates the authorization code flow
13. Execute the following where {username} and {password} are the user credentials set up in step 3 and {clientId} and {clientSecret} are the client imported in step 2. ClientId should be `login-app`,  the secret will be generated by Keycloak.
    1. ```
        curl -L 'http://localhost:9080/realms/ProtocolSN/protocol/openid-connect/token' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: JSESSIONID=C3DBAED921A47E2AC68E93479AFB6136' -d 'username={username}' -d 'password={password}' -d 'client_secret={clientSecret}' -d 'client_id={clientId}' -d 'grant_type=password'
        ```
14. Use the access token from before in the following command
    1. ```
        curl -L 'localhost:8080/direct/customers' -H 'Authorization: Bearer {accessToken}'
    2. This demonstrates that an authorization code flow is possible without going through a browser.